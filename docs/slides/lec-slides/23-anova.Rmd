---
title: "ANOVA"
author: "Becky Tang"
date: "07.12.2021"
output:
  xaringan::moon_reader:
    mathjax: "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML"
    css: "sta199-slides.css"
    logo: img/sta199-sticker-icon.png
    lib_dir: libs/font-awesome
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      slideNumberFormat: "%current%" 
      ratio: "16:9"
---


layout: true

<div class="my-footer">
<span>
<a href="http://datasciencebox.org" target="_blank">datasciencebox.org</a>
</span>
</div> 

```{r setup, include=FALSE}
# R options
options(
  htmltools.dir.version = FALSE, # for blogdown
  show.signif.stars = FALSE,     # for regression output
  warm = 1
  )
# Set dpi and height for images
knitr::opts_chunk$set(fig.height = 3, fig.width = 5, dpi = 300, 
                      warning = FALSE, 
                      message = FALSE, 
                      fig.align = "center") 
# ggplot2 color palette with gray
color_palette <- list(gray = "#999999", 
                      salmon = "#E69F00", 
                      lightblue = "#56B4E9", 
                      green = "#009E73", 
                      yellow = "#F0E442", 
                      darkblue = "#0072B2", 
                      red = "#D55E00", 
                      purple = "#CC79A7")
htmltools::tagList(rmarkdown::html_dependency_font_awesome())
# For magick
dev.off <- function(){
  invisible(grDevices::dev.off())
}
# For ggplot2
ggplot2::theme_set(ggplot2::theme_bw())
```

```{r packages, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(broom)
library(knitr)
library(DT)
library(openintro)
library(infer)
library(patchwork)
library(kableExtra)
library(lubridate)
```

---

## Data 

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
rat_feed <- read.csv("data/rat_feed.csv")
glimpse(rat_feed)
```

---

## Group means

.question[How do we compare across three groups? Which groups are different?]

```{r}
rat_feed %>%
  group_by(type) %>%
  summarise(xbar = mean(wt_gain))
```

---

.question[How do we compare across three groups? Which groups are different?]

```{r echo = F,  fig.height = 2}
ggplot(rat_feed, aes(x = type, y = wt_gain))+
  geom_boxplot()+
  labs(y = "weight gain",
       x = "feed")
```

---

## Hypotheses

We are interested in testing $$H_{0}: \mu_{b} = \mu_{g} = \mu_{p}$$

against the alternative $H_{a}$: at least one mean is different, 
where $\mu_{*}$ is the average weight gain under treatment $*$.

--

We could use $t$-tests (or simulation-based analogue) on all possible pairs of tests.
In this case, there would be three pairs: $(\mu_{b}$ vs $\mu_{g})$, 
$(\mu_{b}$ vs $\mu_{p})$, $(\mu_{g}$ vs $\mu_{p})$.

But what if we had 10 different groups? That would be $\binom{10}{2} = 45$ tests!

---

## Multiple comparisons

- Aside from being tedious, as you've investigated in homework/lab, 
carrying out multiple tests can lead to an inflated Type I error rates.

- We would need some way to account for the fact that multiple comparisons are 
being performed.
 
---

## Multiple comparisons

- Suppose all means are actually equal ($H_0$ is true), and we conduct all three pairwise tests

- Suppose the tests are independent, and conducted at $\alpha = 0.05$ significance level

- Making the "correct decision" means failing to reject in all three tests. 
This probability is $(1-0.05)^3 = 0.95^3 = 0.857$.

- Thus, the probability of reject **at least** one of the three nulls = 
1 - probability of failing to reject all three = $1-0.857 = 0.143 > 0.05 = \alpha$. 
This is calld the .vocab[family-wise error rate].
